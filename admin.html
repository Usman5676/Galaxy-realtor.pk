<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Messages | Galaxy Realtors Admin</title>

    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        .sidebar {
            background-color: #000;
            min-height: 100vh;
            transition: all 0.3s;
        }

        .sidebar-link {
            color: #fff;
            padding: 12px 20px;
            display: block;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: all 0.3s;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background-color: #e8a425;
            color: #000;
        }

        .main-content {
            background-color: #f8f9fa;
        }

        .header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: none;
        }

        .btn-primary {
            background-color: #e8a425;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background-color: #d1941f;
            color: #000;
        }

        .btn-outline {
            background-color: transparent;
            color: #e8a425;
            border: 1px solid #e8a425;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-outline:hover {
            background-color: #e8a425;
            color: #000;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-new {
            background-color: #e8f4fd;
            color: #0066cc;
        }

        .status-replied {
            background-color: #e6f4ea;
            color: #137333;
        }

        .status-archived {
            background-color: #fce8e6;
            color: #c5221f;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            padding: 30px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: #e8a425;
            outline: none;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            color: #666;
            transition: color 0.3s;
        }

        .action-btn:hover {
            color: #e8a425;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding-left: 40px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #e8a425;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                width: 100%;
            }

            .table-responsive {
                overflow-x: auto;
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <span class="close-modal" id="closeAdminLoginModal">&times;</span>
            <h2 class="text-2xl font-bold mb-6 text-center text-[#e8a425]">Admin Login</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminEmail">Email Address</label>
                    <input type="email" id="adminEmail" class="form-control" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" class="form-control" required
                        autocomplete="current-password">
                </div>
                <button type="submit" class="btn-primary w-full flex justify-center items-center"
                    id="adminLoginSubmitBtn">
                    <span id="adminLoginText">Login</span>
                    <div id="adminLoginSpinner" class="loading-spinner ml-2 hidden"></div>
                </button>
            </form>
            <div class="mt-4 text-center text-sm text-gray-600">
                <p>Demo Credentials:</p>
                <p>Email: admin@galaxyrealtors.com</p>
                <p>Password: admin123</p>
            </div>
        </div>
    </div>

    <div class="flex" id="adminPanel" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar w-64">
            <div class="p-4">
                <div class="flex items-center space-x-2 mb-8">
                    <img src="https://res.cloudinary.com/delybxvjs/image/upload/v1762185342/Logo_galaxy_iq3sd4.png"
                        alt="Galaxy Realtors Logo" class="w-10 h-10 object-contain">
                    <span class="text-lg font-bold text-[#FFD700]">Galaxy Realtors Builders</span>
                </div>


                <ul class="space-y-2">
                    <li><a href="#" class="sidebar-link active"><i class="fas fa-envelope mr-3"></i> Contact
                            Messages</a></li>
                    <li><a href="index.html" class="sidebar-link"><i class="fas fa-globe mr-3"></i> View Website</a>
                    </li>
                    <li><a href="#" id="adminLogoutBtn" class="sidebar-link"><i class="fas fa-sign-out-alt mr-3"></i>
                            Logout</a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content flex-1">
            <!-- Header -->
            <div class="header p-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold">Contact Messages</h1>
                    <div class="flex items-center space-x-4">
                        <span id="adminUserName" class="text-gray-700">Admin User</span>
                        <div
                            class="w-8 h-8 rounded-full bg-[#e8a425] flex items-center justify-center text-black font-bold">
                            A</div>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="p-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="card p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500 text-sm">Total Messages</p>
                                <h3 class="text-2xl font-bold" id="totalMessages">0</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                <i class="fas fa-envelope text-blue-500 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500 text-sm">New Messages</p>
                                <h3 class="text-2xl font-bold" id="newMessages">0</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i class="fas fa-envelope-open text-green-500 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500 text-sm">Replied</p>
                                <h3 class="text-2xl font-bold" id="repliedMessages">0</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                <i class="fas fa-reply text-yellow-500 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500 text-sm">Archived</p>
                                <h3 class="text-2xl font-bold" id="archivedMessages">0</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                <i class="fas fa-archive text-red-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="card p-4 mb-6">
                    <div
                        class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0">
                        <div class="flex space-x-4">
                            <button class="btn-outline active" data-filter="all">All</button>
                            <button class="btn-outline" data-filter="new">New</button>
                            <button class="btn-outline" data-filter="replied">Replied</button>
                            <button class="btn-outline" data-filter="archived">Archived</button>
                        </div>

                        <div class="search-box w-full md:w-auto">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" class="form-control" placeholder="Search messages...">
                        </div>
                    </div>
                </div>

                <!-- Messages Table -->
                <div class="card p-4">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Message</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="messagesTable">
                                <!-- Messages will be loaded here dynamically -->
                                <tr>
                                    <td colspan="7" class="text-center py-8 text-gray-500">No messages found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex justify-between items-center mt-4">
                        <div class="text-sm text-gray-500">
                            Showing <span id="showingStart">0</span> to <span id="showingEnd">0</span> of <span
                                id="totalRecords">0</span> entries
                        </div>
                        <div class="flex space-x-2">
                            <button class="btn-outline" id="prevPage">Previous</button>
                            <button class="btn-outline" id="nextPage">Next</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Message Modal -->
    <div id="viewMessageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeViewMessageModal">&times;</span>
            <h2 class="text-2xl font-bold mb-6 text-[#e8a425]">Contact Message</h2>

            <div class="mb-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 id="viewMessageName" class="text-xl font-bold"></h3>
                        <p id="viewMessageEmail" class="text-gray-600"></p>
                        <p id="viewMessagePhone" class="text-gray-600"></p>
                    </div>
                    <div>
                        <span id="viewMessageStatus" class="status-badge status-new">New</span>
                    </div>
                </div>

                <div class="mb-4">
                    <p class="text-gray-500 text-sm">Received:</p>
                    <p id="viewMessageDate" class="font-medium"></p>
                </div>

                <div class="mb-6">
                    <p class="text-gray-500 text-sm mb-2">Message:</p>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <p id="viewMessageContent" class="text-gray-800"></p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="replyMessage">Reply Message</label>
                    <textarea id="replyMessage" class="form-control" rows="4"
                        placeholder="Type your reply here..."></textarea>
                </div>

                <div class="flex justify-end space-x-3">
                    <button class="btn-outline" id="markAsRepliedBtn">Mark as Replied</button>
                    <button class="btn-primary" id="sendReplyBtn">Send Reply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC9EigXaRjEA7A9YR9WgoRX7eBJGZRGf6U",
            authDomain: "galaxy-realtors.firebaseapp.com",
            databaseURL: "https://galaxy-realtors-default-rtdb.firebaseio.com",
            projectId: "galaxy-realtors",
            storageBucket: "galaxy-realtors.firebasestorage.app",
            messagingSenderId: "387847164981",
            appId: "1:387847164981:web:875e02de669488dc2a0d7c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
    </script>

    <script>
        // DOM Elements
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminEmail = document.getElementById('adminEmail');
        const adminPassword = document.getElementById('adminPassword');
        const adminLoginSubmitBtn = document.getElementById('adminLoginSubmitBtn');
        const adminLoginText = document.getElementById('adminLoginText');
        const adminLoginSpinner = document.getElementById('adminLoginSpinner');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const adminUserName = document.getElementById('adminUserName');
        const closeAdminLoginModal = document.getElementById('closeAdminLoginModal');

        const messagesTable = document.getElementById('messagesTable');
        const viewMessageModal = document.getElementById('viewMessageModal');
        const closeViewMessageModal = document.getElementById('closeViewMessageModal');
        const viewMessageName = document.getElementById('viewMessageName');
        const viewMessageEmail = document.getElementById('viewMessageEmail');
        const viewMessagePhone = document.getElementById('viewMessagePhone');
        const viewMessageDate = document.getElementById('viewMessageDate');
        const viewMessageContent = document.getElementById('viewMessageContent');
        const viewMessageStatus = document.getElementById('viewMessageStatus');
        const replyMessage = document.getElementById('replyMessage');
        const markAsRepliedBtn = document.getElementById('markAsRepliedBtn');
        const sendReplyBtn = document.getElementById('sendReplyBtn');

        const searchInput = document.getElementById('searchInput');
        const filterButtons = document.querySelectorAll('[data-filter]');

        const totalMessages = document.getElementById('totalMessages');
        const newMessages = document.getElementById('newMessages');
        const repliedMessages = document.getElementById('repliedMessages');
        const archivedMessages = document.getElementById('archivedMessages');

        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const showingStart = document.getElementById('showingStart');
        const showingEnd = document.getElementById('showingEnd');
        const totalRecords = document.getElementById('totalRecords');

        // State variables
        let currentUser = null;
        let contacts = [];
        let filteredContacts = [];
        let currentFilter = 'all';
        let currentSearch = '';
        let currentPage = 1;
        const itemsPerPage = 10;
        let selectedMessageId = null;

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Check if user is admin
                checkAdminStatus(user);
            } else {
                // Show login modal
                adminLoginModal.style.display = 'flex';
            }
        });

        // Admin login form submission
        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const email = adminEmail.value;
            const password = adminPassword.value;

            // Show loading state
            adminLoginText.textContent = 'Logging in...';
            adminLoginSpinner.classList.remove('hidden');
            adminLoginSubmitBtn.disabled = true;

            // For demo purposes, we'll use a simple check
            if (email === 'admin@galaxyrealtors.com' && password === 'admin123') {
                // Simulate successful login
                setTimeout(() => {
                    const user = {
                        email: email,
                        uid: 'demo-admin-user'
                    };
                    checkAdminStatus(user);
                }, 1000);
            } else {
                // Show error
                setTimeout(() => {
                    alert('Invalid credentials. Please use the demo credentials provided.');

                    // Reset loading state
                    adminLoginText.textContent = 'Login';
                    adminLoginSpinner.classList.add('hidden');
                    adminLoginSubmitBtn.disabled = false;
                }, 1000);
            }
        });

        // Check if user is admin
        function checkAdminStatus(user) {
            currentUser = user;
            adminLoginModal.style.display = 'none';
            adminPanel.style.display = 'flex';
            adminUserName.textContent = user.email;

            // Load contact messages
            loadContactMessages();
        }

        // Logout
        adminLogoutBtn.addEventListener('click', () => {
            currentUser = null;
            adminPanel.style.display = 'none';
            adminLoginModal.style.display = 'flex';
        });

        // Close modals
        closeAdminLoginModal.addEventListener('click', () => {
            adminLoginModal.style.display = 'none';
        });

        closeViewMessageModal.addEventListener('click', () => {
            viewMessageModal.style.display = 'none';
        });

        // Load contact messages from Firebase
        function loadContactMessages() {
            const contactsRef = database.ref('contacts');

            contactsRef.on('value', (snapshot) => {
                contacts = [];
                snapshot.forEach((childSnapshot) => {
                    const contact = childSnapshot.val();
                    contact.id = childSnapshot.key;
                    contacts.push(contact);
                });

                // Sort by date (newest first)
                contacts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                updateStats();
                applyFilters();
            });
        }

        // Update statistics
        function updateStats() {
            const total = contacts.length;
            const newCount = contacts.filter(c => c.status === 'new').length;
            const repliedCount = contacts.filter(c => c.status === 'replied').length;
            const archivedCount = contacts.filter(c => c.status === 'archived').length;

            totalMessages.textContent = total;
            newMessages.textContent = newCount;
            repliedMessages.textContent = repliedCount;
            archivedMessages.textContent = archivedCount;
        }

        // Apply filters and search
        function applyFilters() {
            // Apply status filter
            if (currentFilter === 'all') {
                filteredContacts = [...contacts];
            } else {
                filteredContacts = contacts.filter(contact => contact.status === currentFilter);
            }

            // Apply search filter
            if (currentSearch) {
                const searchLower = currentSearch.toLowerCase();
                filteredContacts = filteredContacts.filter(contact =>
                    contact.name.toLowerCase().includes(searchLower) ||
                    contact.email.toLowerCase().includes(searchLower) ||
                    (contact.phone && contact.phone.toLowerCase().includes(searchLower)) ||
                    contact.message.toLowerCase().includes(searchLower)
                );
            }

            renderTable();
            updatePagination();
        }

        // Render messages table
        function renderTable() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredContacts.length);
            const pageContacts = filteredContacts.slice(startIndex, endIndex);

            if (pageContacts.length === 0) {
                messagesTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-8 text-gray-500">No messages found</td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';

            pageContacts.forEach(contact => {
                const date = new Date(contact.timestamp);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                // Truncate message for table view
                const truncatedMessage = contact.message.length > 50
                    ? contact.message.substring(0, 50) + '...'
                    : contact.message;

                let statusClass = '';
                switch (contact.status) {
                    case 'new':
                        statusClass = 'status-new';
                        break;
                    case 'replied':
                        statusClass = 'status-replied';
                        break;
                    case 'archived':
                        statusClass = 'status-archived';
                        break;
                }

                tableHTML += `
                    <tr>
                        <td>${contact.name}</td>
                        <td>${contact.email}</td>
                        <td>${contact.phone || 'N/A'}</td>
                        <td>${truncatedMessage}</td>
                        <td>${formattedDate}</td>
                        <td><span class="status-badge ${statusClass}">${contact.status}</span></td>
                        <td>
                            <button class="action-btn view-message" data-id="${contact.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn archive-message" data-id="${contact.id}">
                                <i class="fas fa-archive"></i>
                            </button>
                            <button class="action-btn delete-message" data-id="${contact.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            messagesTable.innerHTML = tableHTML;

            // Add event listeners to action buttons
            document.querySelectorAll('.view-message').forEach(btn => {
                btn.addEventListener('click', () => {
                    const messageId = btn.getAttribute('data-id');
                    viewMessage(messageId);
                });
            });

            document.querySelectorAll('.archive-message').forEach(btn => {
                btn.addEventListener('click', () => {
                    const messageId = btn.getAttribute('data-id');
                    archiveMessage(messageId);
                });
            });

            document.querySelectorAll('.delete-message').forEach(btn => {
                btn.addEventListener('click', () => {
                    const messageId = btn.getAttribute('data-id');
                    deleteMessage(messageId);
                });
            });
        }

        // View message details
        function viewMessage(messageId) {
            const contact = contacts.find(c => c.id === messageId);
            if (!contact) return;

            selectedMessageId = messageId;

            const date = new Date(contact.timestamp);
            const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            viewMessageName.textContent = contact.name;
            viewMessageEmail.textContent = contact.email;
            viewMessagePhone.textContent = contact.phone || 'N/A';
            viewMessageDate.textContent = formattedDate;
            viewMessageContent.textContent = contact.message;

            // Set status badge
            viewMessageStatus.textContent = contact.status;
            viewMessageStatus.className = 'status-badge';

            switch (contact.status) {
                case 'new':
                    viewMessageStatus.classList.add('status-new');
                    break;
                case 'replied':
                    viewMessageStatus.classList.add('status-replied');
                    break;
                case 'archived':
                    viewMessageStatus.classList.add('status-archived');
                    break;
            }

            // Clear reply field
            replyMessage.value = '';

            viewMessageModal.style.display = 'flex';
        }

        // Mark message as replied
        markAsRepliedBtn.addEventListener('click', () => {
            if (!selectedMessageId) return;

            database.ref('contacts/' + selectedMessageId).update({
                status: 'replied',
                repliedBy: currentUser.email,
                repliedAt: new Date().toISOString()
            })
                .then(() => {
                    alert('Message marked as replied');
                    viewMessageModal.style.display = 'none';
                })
                .catch(error => {
                    console.error('Error updating message:', error);
                    alert('Failed to update message status');
                });
        });

        // Send reply
        sendReplyBtn.addEventListener('click', () => {
            if (!selectedMessageId) return;

            const reply = replyMessage.value.trim();
            if (!reply) {
                alert('Please enter a reply message');
                return;
            }

            database.ref('contacts/' + selectedMessageId).update({
                status: 'replied',
                repliedBy: currentUser.email,
                repliedAt: new Date().toISOString(),
                replyMessage: reply
            })
                .then(() => {
                    alert('Reply sent successfully');
                    viewMessageModal.style.display = 'none';
                })
                .catch(error => {
                    console.error('Error sending reply:', error);
                    alert('Failed to send reply');
                });
        });

        // Archive message
        function archiveMessage(messageId) {
            if (!confirm('Are you sure you want to archive this message?')) return;

            database.ref('contacts/' + messageId).update({
                status: 'archived',
                archivedBy: currentUser.email,
                archivedAt: new Date().toISOString()
            })
                .catch(error => {
                    console.error('Error archiving message:', error);
                    alert('Failed to archive message');
                });
        }

        // Delete message
        function deleteMessage(messageId) {
            if (!confirm('Are you sure you want to delete this message? This action cannot be undone.')) return;

            database.ref('contacts/' + messageId).remove()
                .catch(error => {
                    console.error('Error deleting message:', error);
                    alert('Failed to delete message');
                });
        }

        // Filter buttons
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons
                filterButtons.forEach(b => b.classList.remove('active'));

                // Add active class to clicked button
                btn.classList.add('active');

                // Set current filter
                currentFilter = btn.getAttribute('data-filter');

                // Reset to first page
                currentPage = 1;

                // Apply filters
                applyFilters();
            });
        });

        // Search input
        searchInput.addEventListener('input', () => {
            currentSearch = searchInput.value;

            // Reset to first page
            currentPage = 1;

            // Apply filters
            applyFilters();
        });

        // Pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredContacts.length / itemsPerPage);

            // Update showing info
            const start = filteredContacts.length > 0 ? (currentPage - 1) * itemsPerPage + 1 : 0;
            const end = Math.min(currentPage * itemsPerPage, filteredContacts.length);

            showingStart.textContent = start;
            showingEnd.textContent = end;
            totalRecords.textContent = filteredContacts.length;

            // Update button states
            prevPage.disabled = currentPage === 1;
            nextPage.disabled = currentPage === totalPages || totalPages === 0;
        }

        prevPage.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                applyFilters();
            }
        });

        nextPage.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredContacts.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                applyFilters();
            }
        });
    </script>
</body>

</html>